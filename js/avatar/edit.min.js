$(function(){function c(a){$("#x").val(a.x),$("#y").val(a.y),$("#w").val(a.w),$("#h").val(a.h)}function d(){$("#img_w").val(a.width()),$("#img_h").val(a.height())}function e(e){if(parseInt(e.w)>0){var f=160/e.w,g=160/e.h;c(e),d(),b.css({width:Math.round(f*a.width())+"px",height:Math.round(g*a.height())+"px",marginLeft:"-"+Math.round(f*e.x)+"px",marginTop:"-"+Math.round(g*e.y)+"px"}).show()}}function f(){b.stop().fadeOut("fast")}var a=$("#jcrop_target"),b=$("#jcrop_preview");a.Jcrop({onChange:e,onSelect:e,onRelease:f,aspectRatio:1}),$("#edit-avatar-form").submit(function(){return d(),$(".failure").hide(),$.ajax({type:"POST",url:window.siteBase+"/avatar/update",data:$("#edit-avatar-form").serialize(),dataType:"json",success:function(a,b,c){a.result==="success"?window.location=window.siteBase+"/profile/"+window.profileId:a.message?$(".failure").html(a.message).show():$(".failure").html("Unknown: "+b).show()},error:function(a,b,c){$(".failure").html("Error: "+b).show()},complete:function(){}}),!1})});